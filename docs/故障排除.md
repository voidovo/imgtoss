# 故障排除指南

本指南包含 ImgToss 使用过程中可能遇到的常见问题及其解决方案。请根据具体症状查找对应的解决方法。

## 安装和启动问题

### 应用无法启动

#### Windows 平台问题

**问题**: 双击应用图标后没有反应
**可能原因**: 
- 缺少必要的运行库
- 安全软件拦截
- 系统兼容性问题

**解决方案**:
```bash
# 1. 安装 Microsoft Visual C++ Redistributable
# 下载并安装最新版本的 Visual C++ Redistributable

# 2. 检查 Windows Defender 或杀毒软件设置
# 将 ImgToss.exe 添加到白名单

# 3. 以管理员身份运行
# 右键点击应用图标 → "以管理员身份运行"

# 4. 兼容性设置
# 右键点击应用 → 属性 → 兼容性 → 以兼容模式运行
```

**问题**: 提示"应用程序无法正常启动(0xc000007b)"
**解决方案**:
```bash
# 安装完整的 .NET Framework 和 Visual C++ 运行库
# 1. 下载并安装 .NET Framework 4.8
# 2. 安装 Visual C++ 2015-2022 Redistributable (x64)
# 3. 重启计算机后再次尝试运行
```

#### macOS 平台问题

**问题**: "无法打开ImgToss，因为无法验证开发者"
**解决方案**:
```bash
# 方法一: 系统偏好设置
# 1. 打开 系统偏好设置 → 安全性与隐私 → 通用
# 2. 点击 "仍要打开" 按钮

# 方法二: 命令行解除隔离
sudo xattr -rd com.apple.quarantine /Applications/ImgToss.app

# 方法三: 允许任何来源的应用
sudo spctl --master-disable
```

**问题**: 应用启动后立即崩溃
**解决方案**:
```bash
# 1. 检查系统版本（需要 macOS 10.15+）
sw_vers

# 2. 检查崩溃日志
# 打开 控制台.app → 崩溃报告 → 查找 ImgToss 相关日志

# 3. 重新安装应用
# 完全删除应用后重新下载安装

# 4. 检查权限设置
# 系统偏好设置 → 安全性与隐私 → 隐私 → 完全磁盘访问权限
# 添加 ImgToss 应用
```

#### Linux 平台问题

**问题**: AppImage 文件无法执行
**解决方案**:
```bash
# 1. 添加执行权限
chmod +x ImgToss-*.AppImage

# 2. 安装 FUSE (如果需要)
# Ubuntu/Debian:
sudo apt install fuse

# CentOS/RHEL:
sudo yum install fuse

# 3. 直接运行
./ImgToss-*.AppImage
```

**问题**: 缺少系统依赖
**解决方案**:
```bash
# Ubuntu/Debian:
sudo apt update
sudo apt install libgtk-3-0 libwebkit2gtk-4.0-37 libssl3

# CentOS/RHEL:
sudo yum install gtk3 webkit2gtk3 openssl

# Arch Linux:
sudo pacman -S gtk3 webkit2gtk

# 如果仍有问题，尝试安装额外依赖:
sudo apt install libayatana-appindicator3-1
```

## 云存储配置问题

### 阿里云 OSS 配置问题

**问题**: 测试连接失败，提示 "InvalidAccessKeyId"
**错误代码**: `InvalidAccessKeyId`
**解决方案**:
```
1. 检查 AccessKey ID 是否正确
   - 登录阿里云控制台 → AccessKey 管理
   - 确认复制的 AccessKey ID 没有多余空格

2. 检查 AccessKey 状态
   - 确认 AccessKey 处于"启用"状态
   - 如果是子用户，确认有 OSS 相关权限

3. 检查账户状态
   - 确认阿里云账户没有欠费
   - 确认 OSS 服务已开通
```

**问题**: 连接超时或网络错误
**错误信息**: `Connection timeout` 或 `Network unreachable`
**解决方案**:
```
1. 检查网络连接
   - 确认网络可正常访问互联网
   - 尝试 ping oss-cn-hangzhou.aliyuncs.com

2. 检查端点配置
   - 确认端点地址格式正确
   - 内网环境使用内网端点：oss-cn-hangzhou-internal.aliyuncs.com
   - 海外使用海外端点

3. 检查防火墙设置
   - 允许 ImgToss 通过防火墙
   - 检查企业网络是否有访问限制

4. 尝试不同的端点
   端点列表：
   - 华东1(杭州): oss-cn-hangzhou.aliyuncs.com
   - 华东2(上海): oss-cn-shanghai.aliyuncs.com  
   - 华北1(青岛): oss-cn-qingdao.aliyuncs.com
   - 华北2(北京): oss-cn-beijing.aliyuncs.com
```

**问题**: 权限不足，上传失败
**错误代码**: `AccessDenied`
**解决方案**:
```
1. 检查 Bucket 权限
   - 确认 AccessKey 对应用户有该 Bucket 的写权限
   - Bucket 权限设置 → 访问控制 → 确认权限配置

2. 检查 RAM 用户权限（如果使用子账号）
   必需权限策略：
   {
     "Version": "1",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": [
           "oss:PutObject",
           "oss:GetObject",
           "oss:DeleteObject",
           "oss:ListObjects"
         ],
         "Resource": [
           "acs:oss:*:*:your-bucket-name",
           "acs:oss:*:*:your-bucket-name/*"
         ]
       }
     ]
   }

3. 检查 Bucket 策略
   - 确认 Bucket 没有设置限制性的访问策略
   - 检查 IP 白名单设置
```

### 腾讯云 COS 配置问题

**问题**: SecretId 或 SecretKey 错误
**错误代码**: `InvalidCredentials`
**解决方案**:
```
1. 获取正确的密钥
   - 登录腾讯云控制台 → 访问管理 → API密钥管理
   - 确认 SecretId 和 SecretKey 匹配

2. 检查密钥权限
   - 确认密钥对应用户有 COS 相关权限
   - 如果是子用户，需要授权相关策略

3. 检查密钥状态
   - 确认密钥处于"启用"状态
   - 如果密钥被禁用，需要重新启用
```

**问题**: Bucket 不存在或无权访问
**错误代码**: `NoSuchBucket` 或 `AccessDenied`
**解决方案**:
```
1. 检查 Bucket 名称格式
   腾讯云 Bucket 名称格式：bucket-appid
   例如：my-images-1234567890

2. 检查 Bucket 区域
   常用区域标识：
   - 北京: ap-beijing
   - 上海: ap-shanghai
   - 广州: ap-guangzhou
   - 成都: ap-chengdu

3. 检查 Bucket 权限设置
   - COS 控制台 → 存储桶列表 → 权限管理
   - 确认账户有读写权限
```

### AWS S3 配置问题

**问题**: Access Key 无效
**错误代码**: `InvalidAccessKeyId`
**解决方案**:
```
1. 检查 IAM 用户设置
   - AWS 控制台 → IAM → 用户 → 安全证书
   - 确认 Access Key 处于活动状态

2. 检查 IAM 权限策略
   必需权限：
   {
     "Version": "2012-10-17",
     "Statement": [
       {
         "Effect": "Allow",
         "Action": [
           "s3:PutObject",
           "s3:GetObject", 
           "s3:DeleteObject",
           "s3:ListBucket"
         ],
         "Resource": [
           "arn:aws:s3:::your-bucket-name",
           "arn:aws:s3:::your-bucket-name/*"
         ]
       }
     ]
   }

3. 检查区域设置
   常用区域：
   - 美国东部1: us-east-1
   - 美国西部2: us-west-2
   - 亚太东京: ap-northeast-1
   - 欧洲爱尔兰: eu-west-1
```

**问题**: S3 兼容服务配置问题
**解决方案**:
```
1. 自定义端点格式
   - 确保端点 URL 格式正确
   - 例如：https://s3.example.com
   - 不要包含 bucket 名称在端点中

2. 路径风格 vs 虚拟主机风格
   - 路径风格：https://s3.example.com/bucket/object
   - 虚拟主机：https://bucket.s3.example.com/object
   - 根据服务提供商选择正确的风格

3. SSL/TLS 设置
   - 确认服务端支持 HTTPS
   - 如果仅支持 HTTP，需要相应配置
```

## 文件上传问题

### 上传失败

**问题**: 单个文件上传失败
**可能原因**: 文件过大、网络中断、权限问题
**解决方案**:
```
1. 检查文件大小
   - 确认文件大小在限制范围内（通常 50MB）
   - 大文件可能需要分片上传支持

2. 检查网络稳定性
   - 使用网络诊断工具检查连接
   - 尝试在网络状况良好时重新上传

3. 检查文件权限
   - 确认应用有读取文件的权限
   - Windows: 右键文件 → 属性 → 安全
   - macOS/Linux: ls -la filename

4. 重试机制
   - ImgToss 支持自动重试
   - 可在设置中调整重试次数和间隔
```

**问题**: 批量上传部分失败
**解决方案**:
```
1. 查看失败详情
   - 在上传历史中查看失败的具体原因
   - 根据错误信息采取相应措施

2. 单独重试失败项
   - 选择失败的文件单独重新上传
   - 检查失败文件是否有特殊字符或权限问题

3. 调整并发设置
   - 降低同时上传的文件数量
   - 设置 → 性能 → 最大并发数

4. 网络优化
   - 选择网络状况好的时段上传
   - 考虑使用有线网络而非 WiFi
```

### 上传速度慢

**问题**: 上传速度明显低于网络带宽
**解决方案**:
```
1. 网络诊断
   - 使用 speedtest 检查实际网络速度
   - 确认上行带宽是否符合预期

2. 服务器选择
   - 选择地理位置较近的云存储区域
   - 阿里云选择就近的区域节点
   - 腾讯云/AWS 同样选择就近区域

3. 并发设置优化
   - 适当增加并发上传数（推荐 2-3 个）
   - 过多并发可能导致网络拥塞

4. 分片上传
   - 对于大文件，确保启用分片上传
   - 调整分片大小以优化传输效率
```

**问题**: 特定文件类型上传慢
**解决方案**:
```
1. 文件格式优化
   - PNG 文件通常比 JPEG 大，上传较慢
   - 考虑在上传前进行适当压缩

2. 预处理设置
   - 设置 → 图片处理 → 启用压缩
   - 设置合适的压缩质量（建议 85%）

3. 格式转换
   - 将 BMP、TIFF 等大格式转为 JPEG 或 PNG
   - 使用内置的格式转换功能
```

## Markdown 文档处理问题

### 图片扫描问题

**问题**: 无法识别 Markdown 中的图片
**可能原因**: 图片链接格式不标准、相对路径错误
**解决方案**:
```
1. 检查图片链接格式
   支持的格式：
   ![alt text](./images/photo.jpg)
   ![alt text](../assets/logo.png)
   ![](images/screenshot.png)
   
   不支持的格式：
   <img src="photo.jpg">  // HTML 标签
   [图片](photo.jpg)      // 链接语法

2. 检查文件路径
   - 确认图片文件确实存在于指定路径
   - 路径中不要包含中文或特殊字符
   - 使用正斜杠 / 而非反斜杠 \

3. 文档编码问题
   - 确保 Markdown 文件使用 UTF-8 编码
   - 避免使用 GBK 等其他编码格式
```

**问题**: 扫描结果显示"文件不存在"
**解决方案**:
```
1. 检查相对路径
   如果 Markdown 文件在：/Users/docs/article.md
   图片引用为：![](./images/photo.jpg)
   那么图片应该在：/Users/docs/images/photo.jpg

2. 检查文件名大小写
   - Linux/macOS 区分大小写
   - 确认文件名和路径的大小写完全匹配

3. 检查文件权限
   - 确认 ImgToss 有访问图片文件的权限
   - macOS 可能需要授予"完全磁盘访问权限"

4. 特殊字符处理
   - 避免文件名包含空格、中文、特殊符号
   - 如必须使用，确保路径被正确引用
```

### 链接替换问题

**问题**: 上传成功但链接没有替换
**解决方案**:
```
1. 检查文件权限
   - 确认 Markdown 文件不是只读状态
   - Windows: 右键 → 属性 → 取消"只读"
   - macOS/Linux: chmod 644 filename.md

2. 检查文件占用
   - 确保文件没有被其他程序打开
   - 关闭可能正在编辑该文件的编辑器

3. 备份机制检查
   - 查看是否生成了 .bak 备份文件
   - 如果备份存在，说明替换过程被中断

4. 手动恢复
   - 如果自动替换失败，可以手动复制链接
   - 在历史记录中找到对应文件的链接
```

**问题**: 替换后的链接无法访问
**解决方案**:
```
1. 检查云存储配置
   - 确认 Bucket 的访问权限设置正确
   - 公共读权限或正确的 CDN 配置

2. 检查 CDN 配置
   - 如果配置了自定义域名，确认域名解析正确
   - 确认 CDN 缓存已生效

3. 链接格式检查
   - 确认生成的链接格式正确
   - https://bucket.oss-region.aliyuncs.com/path/filename.jpg

4. 浏览器缓存
   - 清除浏览器缓存后重试
   - 或在隐私模式下测试链接
```

## 历史记录问题

### 记录丢失

**问题**: 历史记录突然消失
**可能原因**: 数据库文件损坏、应用数据目录迁移
**解决方案**:
```
1. 检查数据库文件
   数据库位置：
   - Windows: %APPDATA%/com.kieran.imgtoss/
   - macOS: ~/Library/Application Support/com.kieran.imgtoss/
   - Linux: ~/.local/share/com.kieran.imgtoss/

2. 数据库修复
   # 如果数据库损坏，尝试修复
   sqlite3 history.db
   .recover main

3. 备份恢复
   - 检查是否有自动备份文件
   - 从备份中恢复历史记录

4. 重建索引
   - 如果记录存在但搜索异常
   - 设置 → 高级 → 重建数据库索引
```

### 搜索功能异常

**问题**: 搜索不到明确存在的记录
**解决方案**:
```
1. 检查搜索条件
   - 确认搜索关键词拼写正确
   - 尝试使用部分关键词搜索

2. 清除搜索缓存
   - 重启应用清除搜索缓存
   - 或在设置中清除应用数据

3. 数据库重建
   - 设置 → 高级 → 重建搜索索引
   - 等待索引重建完成后重试

4. 特殊字符处理
   - 搜索中文文件名时使用准确的字符
   - 避免搜索条件包含特殊符号
```

## 性能问题

### 应用响应缓慢

**问题**: 应用界面卡顿，响应缓慢
**解决方案**:
```
1. 内存使用检查
   - 任务管理器查看 ImgToss 内存使用
   - 如果内存使用过高，重启应用

2. 清理缓存数据
   - 设置 → 存储 → 清理缓存
   - 删除不必要的缩略图缓存

3. 历史记录优化
   - 如果历史记录过多（>10000条），考虑清理旧记录
   - 导出重要记录后删除历史数据

4. 硬件检查
   - 确保有足够的可用磁盘空间（至少 1GB）
   - 检查 CPU 使用率是否正常
```

**问题**: 大量文件处理时崩溃
**解决方案**:
```
1. 批量大小限制
   - 单次处理文件数不超过 100 个
   - 大批量处理分多次进行

2. 内存限制设置
   - 设置 → 性能 → 内存使用限制
   - 设置为系统内存的 1/4 到 1/2

3. 分批处理策略
   - 将大批量任务分解为小批次
   - 每批处理完成后稍作暂停

4. 系统资源监控
   - 使用系统监控工具观察资源使用
   - 在资源充足时进行批量操作
```

## 网络问题

### 连接中断

**问题**: 上传过程中网络连接中断
**解决方案**:
```
1. 断点续传
   - ImgToss 支持断点续传功能
   - 网络恢复后自动或手动恢复上传

2. 网络稳定性检查
   ping -c 10 oss-cn-hangzhou.aliyuncs.com
   # 检查丢包率和延迟

3. 超时设置调整
   - 设置 → 网络 → 连接超时时间
   - 网络较差时可适当增加超时时间

4. 重试机制
   - 启用自动重试功能
   - 设置合理的重试次数和间隔
```

### 代理和防火墙

**问题**: 企业网络环境下无法连接
**解决方案**:
```
1. HTTP 代理配置
   - 设置 → 网络 → HTTP 代理
   - 配置企业代理服务器信息

2. HTTPS 证书问题
   - 企业环境可能有自签名证书
   - 设置 → 安全 → 允许不安全的连接（谨慎使用）

3. 端口限制
   - 确保防火墙允许 HTTPS (443) 端口
   - 某些云服务可能使用其他端口

4. 白名单配置
   需要加入白名单的域名：
   - *.aliyuncs.com (阿里云)
   - *.myqcloud.com (腾讯云)
   - *.amazonaws.com (AWS)
```

## 日志和诊断

### 启用详细日志

当遇到复杂问题时，可以启用详细日志进行诊断：

```bash
# 启用调试模式（开发版本）
RUST_LOG=debug pnpm tauri dev

# 或设置环境变量
export RUST_LOG=imgtoss=debug
```

### 日志文件位置

```
Windows: %APPDATA%/com.kieran.imgtoss/logs/
macOS: ~/Library/Logs/com.kieran.imgtoss/
Linux: ~/.local/share/com.kieran.imgtoss/logs/
```

### 收集诊断信息

如需技术支持，请收集以下信息：

1. **系统信息**
   - 操作系统版本
   - ImgToss 版本号
   - 错误发生的具体时间

2. **配置信息**
   - 云存储服务类型
   - 网络环境（有线/WiFi/企业网络）
   - 代理设置（如有）

3. **错误日志**
   - 应用日志文件
   - 系统错误报告
   - 网络连接日志

4. **重现步骤**
   - 详细描述操作过程
   - 提供测试文件（如适用）
   - 错误发生的频率

## 寻求帮助

### 社区支持

- **GitHub Issues**: https://github.com/your-repo/imgtoss/issues
- **讨论区**: https://github.com/your-repo/imgtoss/discussions
- **FAQ 文档**: 查看项目 Wiki 中的常见问题

### 提交问题报告

提交 Issue 时请包含：

1. **问题标题**: 简洁描述问题
2. **环境信息**: 操作系统、应用版本
3. **重现步骤**: 详细的操作步骤
4. **期望结果**: 您期望的正确行为
5. **实际结果**: 实际发生的情况
6. **相关日志**: 错误信息和日志文件
7. **截图**: 如果有助于说明问题

### 应急处理

如果遇到严重问题导致应用无法使用：

1. **备份数据**: 首先备份重要的配置和历史记录
2. **重置应用**: 清除应用数据并重新配置
3. **降级版本**: 如果问题出现在新版本中，暂时使用稳定版本
4. **手动操作**: 使用其他工具临时处理紧急的图片上传需求

通过以上故障排除指南，您应该能够解决 ImgToss 使用过程中的大部分问题。如果问题依然存在，请不要犹豫，及时寻求社区帮助或提交问题报告。