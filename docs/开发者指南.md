# å¼€å‘è€…æŒ‡å—

æœ¬æŒ‡å—é¢å‘æƒ³è¦å‚ä¸ ImgToss å¼€å‘æˆ–åŸºäº ImgToss è¿›è¡ŒäºŒæ¬¡å¼€å‘çš„å¼€å‘è€…ã€‚è¯¦ç»†ä»‹ç»äº†é¡¹ç›®æ¶æ„ã€å¼€å‘ç¯å¢ƒæ­å»ºã€ä»£ç è§„èŒƒå’Œè´¡çŒ®æµç¨‹ã€‚

## æŠ€æœ¯æ¶æ„æ¦‚è¿°

ImgToss é‡‡ç”¨ç°ä»£åŒ–çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œç»“åˆäº† Web æŠ€æœ¯å’Œæ¡Œé¢åº”ç”¨çš„ä¼˜åŠ¿ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ImgToss æ¶æ„å›¾                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Frontend (Next.js)          â”‚  Backend (Tauri + Rust)  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Next.js 15 + React 19   â”‚â—„â”¤ â”‚ Tauri 2 Framework       â”‚â”‚
â”‚  â”‚ TypeScript + Tailwind   â”‚ â”‚ â”‚ Rust Services Layer     â”‚â”‚
â”‚  â”‚ Radix UI Components     â”‚ â”‚ â”‚ SQLite Database         â”‚â”‚
â”‚  â”‚ Custom Hooks & Context  â”‚ â”‚ â”‚ Async File Operations   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Communication Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Tauri Commands Bridge (JSON-RPC over IPC)           â”‚ â”‚
â”‚  â”‚ Type-safe API with full TypeScript integration     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                External Services                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚é˜¿é‡Œäº‘OSS â”‚ â”‚è…¾è®¯äº‘COS â”‚ â”‚ AWS S3  â”‚ â”‚  S3å…¼å®¹æœåŠ¡     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æŠ€æœ¯æ ˆ

#### å‰ç«¯æŠ€æœ¯
- **Next.js 15**: App Router + React Server Components
- **React 19**: æœ€æ–°çš„ React ç‰¹æ€§å’Œ Hooks
- **TypeScript**: å®Œæ•´çš„ç±»å‹å®‰å…¨ä¿éšœ
- **Tailwind CSS**: å®ç”¨ä¼˜å…ˆçš„æ ·å¼æ¡†æ¶
- **Radix UI**: æ— éšœç¢è®¿é—®çš„ç»„ä»¶åŸºç¡€åº“
- **React Hook Form**: é«˜æ€§èƒ½è¡¨å•ç®¡ç†
- **Zustand**: è½»é‡çº§çŠ¶æ€ç®¡ç†

#### åç«¯æŠ€æœ¯
- **Tauri 2**: è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶
- **Rust**: ç³»ç»Ÿçº§ç¼–ç¨‹è¯­è¨€ï¼Œå†…å­˜å®‰å…¨
- **SQLite**: åµŒå…¥å¼å…³ç³»æ•°æ®åº“
- **Tokio**: å¼‚æ­¥è¿è¡Œæ—¶ï¼Œé«˜å¹¶å‘æ”¯æŒ
- **Reqwest**: HTTPå®¢æˆ·ç«¯åº“
- **Serde**: åºåˆ—åŒ–/ååºåˆ—åŒ–æ¡†æ¶

#### å¼€å‘å·¥å…·
- **pnpm**: å¿«é€Ÿã€èŠ‚çœç©ºé—´çš„åŒ…ç®¡ç†å™¨
- **Vitest**: ç°ä»£åŒ–çš„æµ‹è¯•æ¡†æ¶
- **ESLint + Prettier**: ä»£ç è´¨é‡å’Œæ ¼å¼åŒ–
- **TypeScript**: é™æ€ç±»å‹æ£€æŸ¥

## å¼€å‘ç¯å¢ƒæ­å»º

### ç³»ç»Ÿè¦æ±‚

å¼€å‘ ImgToss éœ€è¦ä»¥ä¸‹ç³»ç»Ÿç¯å¢ƒï¼š

| ç»„ä»¶ | ç‰ˆæœ¬è¦æ±‚ | å¤‡æ³¨ |
|------|----------|------|
| Node.js | 18.0+ | æ¨è 20.x LTS |
| Rust | 1.70+ | æœ€æ–°ç¨³å®šç‰ˆ |
| pnpm | 8.0+ | åŒ…ç®¡ç†å™¨ |
| Git | 2.0+ | ç‰ˆæœ¬æ§åˆ¶ |

### è¯¦ç»†å®‰è£…æ­¥éª¤

#### 1. å®‰è£… Node.js å’Œ pnpm

```bash
# ä½¿ç”¨ nvm å®‰è£… Node.js (æ¨è)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 20
nvm use 20

# å®‰è£… pnpm
npm install -g pnpm

# éªŒè¯å®‰è£…
node --version  # v20.x.x
pnpm --version  # 8.x.x
```

#### 2. å®‰è£… Rust å·¥å…·é“¾

```bash
# å®‰è£… Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.bashrc

# éªŒè¯å®‰è£…
rustc --version  # rustc 1.70+
cargo --version  # cargo 1.70+

# å®‰è£… Tauri CLI
cargo install tauri-cli --version \"^2.0.0\"
```

#### 3. å¹³å°ç‰¹å®šä¾èµ–

**Linux (Ubuntu/Debian):**
```bash
sudo apt update
sudo apt install libgtk-3-dev libwebkit2gtk-4.0-dev libssl-dev
```

**macOS:**
```bash
# ç¡®ä¿å®‰è£…äº† Xcode Command Line Tools
xcode-select --install
```

**Windows:**
```powershell
# ç¡®ä¿å®‰è£…äº† Microsoft C++ Build Tools
# å’Œ WebView2 Runtime
```

#### 4. å…‹éš†å’Œé…ç½®é¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-repo/imgtoss.git
cd imgtoss

# å®‰è£…å‰ç«¯ä¾èµ–
pnpm install

# å®‰è£… Rust ä¾èµ–ï¼ˆè‡ªåŠ¨æ‰§è¡Œï¼‰
cd src-tauri
cargo build
cd ..

# éªŒè¯å¼€å‘ç¯å¢ƒ
pnpm tauri dev
```

### å¼€å‘æœåŠ¡å™¨

#### å¯åŠ¨å¼€å‘ç¯å¢ƒ
```bash
# æ–¹å¼ä¸€: åŒæ—¶å¯åŠ¨å‰åç«¯ï¼ˆæ¨èï¼‰
pnpm tauri dev

# æ–¹å¼äºŒ: åˆ†åˆ«å¯åŠ¨
# ç»ˆç«¯1 - å‰ç«¯å¼€å‘æœåŠ¡å™¨
pnpm dev

# ç»ˆç«¯2 - Tauri å¼€å‘æ¨¡å¼
pnpm tauri dev --no-dev-server
```

#### çƒ­é‡è½½æ”¯æŒ
- **å‰ç«¯çƒ­é‡è½½**: Next.js å¼€å‘æœåŠ¡å™¨æä¾›å³æ—¶çƒ­é‡è½½
- **åç«¯çƒ­é‡è½½**: Rust ä»£ç ä¿®æ”¹åéœ€é‡å¯ Tauri
- **é…ç½®çƒ­é‡è½½**: `tauri.conf.json` ä¿®æ”¹è‡ªåŠ¨é‡å¯åº”ç”¨

## é¡¹ç›®ç»“æ„è¯¦è§£

### ç›®å½•ç»“æ„
```
imgtoss/
â”œâ”€â”€ ğŸ“ app/                     # Next.js App Router é¡µé¢
â”‚   â”œâ”€â”€ dashboard/              # ä»ªè¡¨æ¿é¡µé¢
â”‚   â”œâ”€â”€ image-upload/           # å›¾ç‰‡ä¸Šä¼ é¡µé¢  
â”‚   â”œâ”€â”€ storage/               # å­˜å‚¨é…ç½®é¡µé¢
â”‚   â”œâ”€â”€ history/               # å†å²è®°å½•é¡µé¢
â”‚   â”œâ”€â”€ globals.css            # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ layout.tsx             # æ ¹å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ page.tsx               # é¦–é¡µ
â”‚
â”œâ”€â”€ ğŸ“ components/             # React ç»„ä»¶
â”‚   â”œâ”€â”€ ui/                    # åŸºç¡€ UI ç»„ä»¶ (Radix UI)
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ kokonutui/             # ä¸šåŠ¡ç»„ä»¶
â”‚       â”œâ”€â”€ dashboard.tsx      # ä»ªè¡¨æ¿ç»„ä»¶
â”‚       â”œâ”€â”€ image-upload.tsx   # ä¸Šä¼ ç»„ä»¶
â”‚       â”œâ”€â”€ storage-config.tsx # é…ç½®ç»„ä»¶
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ ğŸ“ lib/                    # å·¥å…·åº“å’Œ API
â”‚   â”œâ”€â”€ contexts/              # React Context
â”‚   â”‚   â”œâ”€â”€ app-state-context.tsx
â”‚   â”‚   â””â”€â”€ theme-context.tsx
â”‚   â”œâ”€â”€ hooks/                 # è‡ªå®šä¹‰ Hooks
â”‚   â”‚   â”œâ”€â”€ use-progress-monitoring.ts
â”‚   â”‚   â”œâ”€â”€ use-app-config.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ cn.ts             # className å·¥å…·
â”‚   â”‚   â”œâ”€â”€ state-recovery.ts  # çŠ¶æ€æ¢å¤
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ __tests__/            # å‰ç«¯æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ tauri-integration.test.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ tauri-api.ts          # Tauri API å°è£…
â”‚   â””â”€â”€ types.ts              # TypeScript ç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ ğŸ“ src-tauri/             # Tauri åç«¯
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ commands/          # Tauri å‘½ä»¤å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ file_commands.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ upload_commands.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ config_commands.rs
â”‚   â”‚   â”‚   â””â”€â”€ tests.rs       # åç«¯æµ‹è¯•
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ config_service.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ file_service.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ image_service.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ oss_service.rs
â”‚   â”‚   â”‚   â””â”€â”€ history_service.rs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ config.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ file.rs
â”‚   â”‚   â”‚   â””â”€â”€ history.rs
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ utils/           # å·¥å…·æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”‚   â”œâ”€â”€ error.rs     # é”™è¯¯å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ crypto.rs    # åŠ å¯†å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ validation.rs # è¾“å…¥éªŒè¯
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ lib.rs           # åº“å…¥å£
â”‚   â”‚   â””â”€â”€ main.rs          # åº”ç”¨å…¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ Cargo.toml           # Rust ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tauri.conf.json      # Tauri é…ç½®
â”‚   â”œâ”€â”€ build.rs             # æ„å»ºè„šæœ¬
â”‚   â””â”€â”€ icons/              # åº”ç”¨å›¾æ ‡
â”‚
â”œâ”€â”€ ğŸ“ docs/                 # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ ğŸ“„ package.json          # Node.js é¡¹ç›®é…ç½®
â”œâ”€â”€ ğŸ“„ tailwind.config.js    # Tailwind é…ç½®
â”œâ”€â”€ ğŸ“„ next.config.js        # Next.js é…ç½®
â”œâ”€â”€ ğŸ“„ tsconfig.json         # TypeScript é…ç½®
â””â”€â”€ ğŸ“„ README.md            # é¡¹ç›®è¯´æ˜
```

### æ¶æ„å±‚æ¬¡è¯´æ˜

#### å‰ç«¯æ¶æ„ (Next.js Layer)
```typescript
// app/layout.tsx - æ ¹å¸ƒå±€
export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="zh-CN">
      <body className={inter.className}>
        <ThemeProvider>
          <AppStateProvider>
            {children}
          </AppStateProvider>
        </ThemeProvider>
      </body>
    </html>
  );
}

// é¡µé¢ç»„ä»¶é€šè¿‡ Tauri API ä¸åç«¯é€šä¿¡
const uploadFile = async (file: File) => {
  const result = await uploadImage({
    filePath: file.path,
    configId: selectedConfig.id
  });
  return result;
};
```

#### åç«¯æ¶æ„ (Tauri + Rust Layer)
```rust
// src-tauri/src/main.rs - åº”ç”¨å…¥å£
fn main() {
    tauri::Builder::default()
        .plugin(tauri_plugin_stronghold::Builder::new().build())
        .invoke_handler(tauri::generate_handler![
            commands::upload_image,
            commands::scan_markdown_images,
            commands::get_upload_history,
            // ... æ›´å¤šå‘½ä»¤
        ])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}

// å‘½ä»¤å±‚å¤„ç†å‰ç«¯è¯·æ±‚
#[tauri::command]
pub async fn upload_image(
    file_path: String,
    config_id: String,
) -> Result<UploadResult, String> {
    let service = ImageService::new();
    service.upload_image(file_path, config_id).await
        .map_err(|e| e.to_string())
}
```

### é€šä¿¡æœºåˆ¶

#### å‰ç«¯åˆ°åç«¯é€šä¿¡
```typescript
// lib/tauri-api.ts - ç±»å‹å®‰å…¨çš„ API å°è£…
import { invoke } from '@tauri-apps/api/tauri';

export interface UploadImageParams {
  filePath: string;
  configId: string;
}

export interface UploadResult {
  id: string;
  url: string;
  fileSize: number;
  uploadTime: string;
}

export async function uploadImage(
  params: UploadImageParams
): Promise<UploadResult> {
  return await invoke<UploadResult>('upload_image', params);
}
```

#### åç«¯åˆ°å‰ç«¯äº‹ä»¶
```rust
// Rust ä¸­å‘é€äº‹ä»¶åˆ°å‰ç«¯
use tauri::Manager;

#[tauri::command]
pub async fn start_batch_upload(
    app_handle: tauri::AppHandle,
    files: Vec<String>,
) -> Result<(), String> {
    for (index, file) in files.iter().enumerate() {
        // ä¸Šä¼ é€»è¾‘...
        
        // å‘é€è¿›åº¦äº‹ä»¶
        app_handle.emit_all("upload-progress", UploadProgress {
            file_index: index,
            progress: 0.5,
            bytes_uploaded: 1024,
            total_bytes: 2048,
        }).unwrap();
    }
    
    Ok(())
}
```

```typescript
// å‰ç«¯ç›‘å¬åç«¯äº‹ä»¶
import { listen } from '@tauri-apps/api/event';

useEffect(() => {
  const unlisten = listen<UploadProgress>('upload-progress', (event) => {
    setUploadProgress(event.payload);
  });
  
  return () => {
    unlisten.then(fn => fn());
  };
}, []);
```

## API è®¾è®¡è§„èŒƒ

### å‘½ä»¤å‘½åè§„èŒƒ

æ‰€æœ‰ Tauri å‘½ä»¤ä½¿ç”¨ `snake_case` å‘½åï¼Œå¹¶æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç»„ï¼š

```rust
// æ–‡ä»¶æ“ä½œç›¸å…³
scan_markdown_images
validate_file_path
get_file_info

// ä¸Šä¼ æ“ä½œç›¸å…³  
upload_image
upload_batch_images
cancel_upload
get_upload_progress

// é…ç½®ç®¡ç†ç›¸å…³
get_storage_configs
save_storage_config  
test_storage_connection
delete_storage_config

// å†å²è®°å½•ç›¸å…³
get_upload_history
search_upload_history
export_upload_history
delete_history_record
```

### ç±»å‹å®šä¹‰è§„èŒƒ

æ‰€æœ‰æ•°æ®ç»“æ„åœ¨ Rust å’Œ TypeScript ä¸­ä¿æŒä¸€è‡´ï¼š

```rust
// src-tauri/src/models/config.rs
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct StorageConfig {
    pub id: String,
    pub name: String,
    pub provider: StorageProvider,
    pub endpoint: String,
    pub region: String,
    pub bucket: String,
    pub access_key: String,
    pub secret_key: String,
    pub custom_path: Option<String>,
    pub is_default: bool,
    pub created_at: chrono::DateTime<chrono::Utc>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum StorageProvider {
    AliyunOSS,
    TencentCOS,
    AWSS3,
    CustomS3,
}
```

```typescript
// lib/types.ts
export interface StorageConfig {
  id: string;
  name: string;
  provider: StorageProvider;
  endpoint: string;
  region: string;
  bucket: string;
  accessKey: string;
  secretKey: string;
  customPath?: string;
  isDefault: boolean;
  createdAt: string;
}

export type StorageProvider = 
  | 'AliyunOSS'
  | 'TencentCOS' 
  | 'AWSS3'
  | 'CustomS3';
```

### é”™è¯¯å¤„ç†è§„èŒƒ

#### ç»Ÿä¸€é”™è¯¯ç±»å‹
```rust
// src-tauri/src/utils/error.rs
#[derive(Debug, thiserror::Error)]
pub enum AppError {
    #[error("æ–‡ä»¶æ“ä½œé”™è¯¯: {0}")]
    FileOperation(String),
    
    #[error("ç½‘ç»œè¯·æ±‚é”™è¯¯: {0}")]
    Network(#[from] reqwest::Error),
    
    #[error("é…ç½®é”™è¯¯: {0}")]
    Configuration(String),
    
    #[error("éªŒè¯é”™è¯¯: {0}")]
    Validation(String),
    
    #[error("æ•°æ®åº“é”™è¯¯: {0}")]
    Database(#[from] rusqlite::Error),
}

impl Serialize for AppError {
    fn serialize<S>(&self, serializer: S) -> Result<S::Ok, S::Error>
    where
        S: serde::Serializer,
    {
        serializer.serialize_str(&self.to_string())
    }
}
```

#### å‰ç«¯é”™è¯¯å¤„ç†
```typescript
// lib/utils/error-handling.ts
export interface ApiError {
  message: string;
  code?: string;
  details?: Record<string, any>;
}

export function handleApiError(error: unknown): ApiError {
  if (typeof error === 'string') {
    return { message: error };
  }
  
  if (error instanceof Error) {
    return { message: error.message };
  }
  
  return { message: 'æœªçŸ¥é”™è¯¯' };
}

// ä½¿ç”¨ç¤ºä¾‹
try {
  const result = await uploadImage(params);
  return result;
} catch (error) {
  const apiError = handleApiError(error);
  toast.error(apiError.message);
  throw apiError;
}
```

## å¼€å‘è§„èŒƒå’Œæœ€ä½³å®è·µ

### ä»£ç é£æ ¼è§„èŒƒ

#### TypeScript/React è§„èŒƒ
```typescript
// 1. ç»„ä»¶å‘½åä½¿ç”¨ PascalCase
export function ImageUploadDialog({ 
  open, 
  onOpenChange 
}: {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}) {
  // ç»„ä»¶é€»è¾‘
}

// 2. Hook ä½¿ç”¨ camelCaseï¼Œä»¥ use å¼€å¤´
export function useUploadProgress(uploadId: string) {
  const [progress, setProgress] = useState(0);
  // Hook é€»è¾‘
  return { progress };
}

// 3. å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE
const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
const SUPPORTED_FORMATS = ['jpg', 'png', 'gif', 'webp'];

// 4. æ¥å£å®šä¹‰ä½¿ç”¨ PascalCase
export interface UploadOptions {
  maxConcurrent: number;
  retryCount: number;
  autoRetry: boolean;
}
```

#### Rust ä»£ç è§„èŒƒ
```rust
// 1. ç»“æ„ä½“ä½¿ç”¨ PascalCase
pub struct ImageService {
    config: StorageConfig,
    client: reqwest::Client,
}

// 2. å‡½æ•°å’Œå˜é‡ä½¿ç”¨ snake_case
impl ImageService {
    pub fn new(config: StorageConfig) -> Self {
        let client = reqwest::Client::new();
        Self { config, client }
    }
    
    pub async fn upload_image(&self, file_path: &str) -> Result<UploadResult> {
        let file_content = tokio::fs::read(file_path).await?;
        // ä¸Šä¼ é€»è¾‘
        Ok(UploadResult { /* ... */ })
    }
}

// 3. å¸¸é‡ä½¿ç”¨ UPPER_SNAKE_CASE
const MAX_UPLOAD_SIZE: usize = 50 * 1024 * 1024;
const DEFAULT_TIMEOUT: u64 = 30;
```

### æµ‹è¯•è§„èŒƒ

#### å‰ç«¯æµ‹è¯•
```typescript
// lib/__tests__/tauri-integration.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { uploadImage } from '../tauri-api';

// Mock Tauri API
vi.mock('@tauri-apps/api/tauri', () => ({
  invoke: vi.fn(),
}));

describe('Tauri API Integration', () => {
  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('should upload image successfully', async () => {
    const mockResult = {
      id: 'test-id',
      url: 'https://example.com/image.jpg',
      fileSize: 1024,
      uploadTime: '2024-01-30T14:30:22Z'
    };
    
    vi.mocked(invoke).mockResolvedValue(mockResult);
    
    const result = await uploadImage({
      filePath: '/path/to/image.jpg',
      configId: 'config-id'
    });
    
    expect(result).toEqual(mockResult);
    expect(invoke).toHaveBeenCalledWith('upload_image', {
      filePath: '/path/to/image.jpg',
      configId: 'config-id'
    });
  });
});
```

#### åç«¯æµ‹è¯•
```rust
// src-tauri/src/commands/tests.rs
#[cfg(test)]
mod tests {
    use super::*;
    use tempfile::tempdir;
    use tokio_test;

    #[tokio::test]
    async fn test_validate_file_path() {
        let temp_dir = tempdir().unwrap();
        let file_path = temp_dir.path().join("test.jpg");
        std::fs::write(&file_path, b"test content").unwrap();
        
        let result = validate_file_path(
            file_path.to_string_lossy().to_string()
        ).await;
        
        assert!(result.is_ok());
        let validation = result.unwrap();
        assert!(validation.exists);
        assert!(validation.is_readable);
    }

    #[tokio::test]
    async fn test_scan_markdown_images() {
        let temp_dir = tempdir().unwrap();
        let md_file = temp_dir.path().join("test.md");
        
        let content = r#"# Test Document
        ![Image 1](./images/photo.jpg)
        ![Image 2](../assets/logo.png)
        "#;
        
        std::fs::write(&md_file, content).unwrap();
        
        let result = scan_markdown_images(
            md_file.to_string_lossy().to_string()
        ).await;
        
        assert!(result.is_ok());
        let images = result.unwrap();
        assert_eq!(images.len(), 2);
    }
}
```

### æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

#### å‰ç«¯æ€§èƒ½ä¼˜åŒ–
```typescript
// 1. ä½¿ç”¨ React.memo ä¼˜åŒ–ç»„ä»¶é‡æ¸²æŸ“
export const ImageCard = React.memo(function ImageCard({
  image,
  onSelect,
  onRemove
}: ImageCardProps) {
  return (
    <div className="image-card">
      {/* ç»„ä»¶å†…å®¹ */}
    </div>
  );
});

// 2. ä½¿ç”¨ useMemo ç¼“å­˜è®¡ç®—ç»“æœ
function UploadList({ files }: { files: File[] }) {
  const totalSize = useMemo(() => {
    return files.reduce((sum, file) => sum + file.size, 0);
  }, [files]);

  const formattedSize = useMemo(() => {
    return formatFileSize(totalSize);
  }, [totalSize]);

  return <div>æ€»å¤§å°: {formattedSize}</div>;
}

// 3. ä½¿ç”¨ useCallback ä¼˜åŒ–äº‹ä»¶å¤„ç†å‡½æ•°
function ImageUpload() {
  const [files, setFiles] = useState<File[]>([]);

  const handleFileSelect = useCallback((newFiles: File[]) => {
    setFiles(prev => [...prev, ...newFiles]);
  }, []);

  const handleFileRemove = useCallback((fileId: string) => {
    setFiles(prev => prev.filter(f => f.id !== fileId));
  }, []);

  return (
    <FileDropzone 
      onFilesSelect={handleFileSelect}
      onFileRemove={handleFileRemove}
    />
  );
}
```

#### åç«¯æ€§èƒ½ä¼˜åŒ–
```rust
// 1. ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥
use tokio::sync::OnceCell;
use rusqlite::Connection;

static DB_POOL: OnceCell<Arc<Mutex<Connection>>> = OnceCell::const_new();

async fn get_db_connection() -> Result<Arc<Mutex<Connection>>, AppError> {
    DB_POOL
        .get_or_init(|| async {
            let conn = Connection::open("app.db")?;
            // é…ç½®è¿æ¥
            Ok(Arc::new(Mutex::new(conn)))
        })
        .await
}

// 2. ä½¿ç”¨å¼‚æ­¥æµå¤„ç†å¤§æ–‡ä»¶
use tokio_util::codec::{BytesCodec, FramedRead};

async fn upload_large_file(file_path: &str) -> Result<UploadResult, AppError> {
    let file = File::open(file_path).await?;
    let stream = FramedRead::new(file, BytesCodec::new());
    
    // åˆ†å—ä¸Šä¼ 
    let mut upload_parts = Vec::new();
    pin_mut!(stream);
    
    while let Some(chunk) = stream.next().await {
        let chunk = chunk?;
        let part = upload_chunk(chunk).await?;
        upload_parts.push(part);
    }
    
    complete_multipart_upload(upload_parts).await
}

// 3. æ‰¹é‡æ“ä½œä¼˜åŒ–æ•°æ®åº“æ€§èƒ½
async fn batch_insert_history(
    conn: &Connection,
    records: Vec<HistoryRecord>
) -> Result<(), AppError> {
    let mut stmt = conn.prepare(
        "INSERT INTO upload_history (id, filename, url, file_size, upload_time) 
         VALUES (?1, ?2, ?3, ?4, ?5)"
    )?;
    
    for record in records {
        stmt.execute(params![
            record.id,
            record.filename,
            record.url,
            record.file_size,
            record.upload_time,
        ])?;
    }
    
    Ok(())
}
```

## æ„å»ºå’Œéƒ¨ç½²

### å¼€å‘æ„å»º
```bash
# å‰ç«¯å¼€å‘æ„å»º
pnpm build

# Tauri å¼€å‘æ„å»º
pnpm tauri build --debug

# æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la src-tauri/target/debug/
```

### ç”Ÿäº§æ„å»º
```bash
# å®Œæ•´ç”Ÿäº§æ„å»º
pnpm tauri build

# ç”Ÿæˆçš„æ–‡ä»¶ä½ç½®ï¼š
# - Windows: src-tauri/target/release/bundle/msi/
# - macOS: src-tauri/target/release/bundle/dmg/
# - Linux: src-tauri/target/release/bundle/deb/ æˆ– appimage/
```

### æ„å»ºé…ç½®ä¼˜åŒ–
```json
// tauri.conf.json
{
  "build": {
    "beforeBuildCommand": "pnpm build",
    "frontendDist": "../out"
  },
  "bundle": {
    "active": true,
    "targets": "all",
    "identifier": "com.kieran.imgtoss",
    "category": "Developer Tool",
    "shortDescription": "ç°ä»£åŒ–å›¾åƒä¸Šä¼ ç®¡ç†å·¥å…·",
    "longDescription": "ä¸€æ¬¾ä¸“ä¸ºå¼€å‘è€…å’Œå†…å®¹åˆ›ä½œè€…è®¾è®¡çš„å›¾åƒä¸Šä¼ ç®¡ç†å·¥å…·...",
    "resources": [
      "resources/*"
    ],
    "externalBin": [],
    "copyright": "2024, ImgToss Contributors",
    "licenseFile": "../LICENSE",
    "icon": [
      "icons/32x32.png",
      "icons/128x128.png",
      "icons/128x128@2x.png",
      "icons/icon.icns",
      "icons/icon.ico"
    ]
  }
}
```

### CI/CD é…ç½®
```yaml
# .github/workflows/build.yml
name: Build and Release

on:
  push:
    tags:
      - 'v*'
  pull_request:
    branches: [ main ]

jobs:
  test-tauri:
    strategy:
      fail-fast: false
      matrix:
        platform: [macos-latest, ubuntu-22.04, windows-latest]

    runs-on: ${{ matrix.platform }}
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: Install pnpm
        run: npm install -g pnpm

      - name: Rust setup
        uses: dtolnay/rust-toolchain@stable

      - name: Rust cache
        uses: swatinem/rust-cache@v2
        with:
          workspaces: './src-tauri -> target'

      - name: Install dependencies (ubuntu only)
        if: matrix.platform == 'ubuntu-22.04'
        run: |
          sudo apt-get update
          sudo apt-get install -y libgtk-3-dev libwebkit2gtk-4.0-dev libssl-dev

      - name: Install frontend dependencies
        run: pnpm install

      - name: Run frontend tests
        run: pnpm test:run

      - name: Run Rust tests
        run: cd src-tauri && cargo test

      - name: Build the app
        run: pnpm tauri build

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.platform }}-app
          path: |
            src-tauri/target/release/bundle/*/
```

## è´¡çŒ®æŒ‡å—

### è´¡çŒ®æµç¨‹

1. **Fork ä»“åº“**: åœ¨ GitHub ä¸Š Fork ImgToss ä»“åº“
2. **åˆ›å»ºåˆ†æ”¯**: åŸºäº main åˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
   ```bash
   git checkout -b feature/awesome-feature
   ```
3. **å¼€å‘åŠŸèƒ½**: æŒ‰ç…§ä»£ç è§„èŒƒå¼€å‘æ–°åŠŸèƒ½
4. **ç¼–å†™æµ‹è¯•**: ä¸ºæ–°åŠŸèƒ½æ·»åŠ ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹
5. **æäº¤ä»£ç **: ä½¿ç”¨æ¸…æ™°çš„æäº¤ä¿¡æ¯
   ```bash
   git commit -m "feat: æ·»åŠ è‡ªåŠ¨é‡å¤æ£€æµ‹åŠŸèƒ½"
   ```
6. **æ¨é€åˆ†æ”¯**: æ¨é€åˆ°æ‚¨çš„ Fork ä»“åº“
   ```bash
   git push origin feature/awesome-feature
   ```
7. **åˆ›å»º PR**: åœ¨ GitHub ä¸Šåˆ›å»º Pull Request

### æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨çº¦å®šå¼æäº¤ (Conventional Commits) æ ¼å¼ï¼š

```
<ç±»å‹>[å¯é€‰ ä½œç”¨åŸŸ]: <æè¿°>

[å¯é€‰ æ­£æ–‡]

[å¯é€‰ è„šæ³¨]
```

**ç±»å‹è¯´æ˜ï¼š**
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼ä¿®æ”¹
- `refactor`: ä»£ç é‡æ„
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨

**ç¤ºä¾‹ï¼š**
```bash
feat(upload): æ·»åŠ æ‰¹é‡ä¸Šä¼ è¿›åº¦æ¡æ˜¾ç¤º
fix(config): ä¿®å¤é…ç½®ä¿å­˜æ—¶çš„åŠ å¯†é—®é¢˜
docs: æ›´æ–° API æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
```

### ä»£ç å®¡æŸ¥æ¸…å•

æäº¤ PR å‰è¯·æ£€æŸ¥ï¼š

#### åŠŸèƒ½æ€§æ£€æŸ¥
- [ ] æ–°åŠŸèƒ½æŒ‰é¢„æœŸå·¥ä½œ
- [ ] ä¸ä¼šç ´åç°æœ‰åŠŸèƒ½
- [ ] é”™è¯¯æƒ…å†µå¾—åˆ°æ­£ç¡®å¤„ç†
- [ ] ç”¨æˆ·ç•Œé¢å‹å¥½ä¸”ç›´è§‚

#### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] éµå¾ªé¡¹ç›®ä»£ç è§„èŒƒ
- [ ] æ·»åŠ äº†å¿…è¦çš„æ³¨é‡Š
- [ ] æ²¡æœ‰æœªä½¿ç”¨çš„å¯¼å…¥æˆ–å˜é‡
- [ ] å‡½æ•°å’Œç±»çš„èŒè´£å•ä¸€

#### æµ‹è¯•æ£€æŸ¥
- [ ] ä¸ºæ–°åŠŸèƒ½æ·»åŠ äº†æµ‹è¯•ç”¨ä¾‹
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•è¦†ç›–äº†ä¸»è¦ä»£ç è·¯å¾„
- [ ] åŒ…å«è¾¹ç•Œæ¡ä»¶æµ‹è¯•

#### æ–‡æ¡£æ£€æŸ¥
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] API å˜æ›´æœ‰è¯¦ç»†è¯´æ˜
- [ ] æ·»åŠ äº†ä½¿ç”¨ç¤ºä¾‹
- [ ] æ›´æ–°äº†å˜æ›´æ—¥å¿—

### å¼€å‘ç¯å¢ƒå»ºè®®

#### VS Code æ‰©å±•æ¨è
```json
// .vscode/extensions.json
{
  "recommendations": [
    "rust-lang.rust-analyzer",
    "tauri-apps.tauri-vscode",
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-typescript-next",
    "vitest.explorer"
  ]
}
```

#### VS Code è®¾ç½®
```json
// .vscode/settings.json
{
  "rust-analyzer.linkedProjects": ["./src-tauri/Cargo.toml"],
  "typescript.preferences.importModuleSpecifier": "relative",
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "[rust]": {
    "editor.defaultFormatter": "rust-lang.rust-analyzer"
  }
}
```

é€šè¿‡éµå¾ªæœ¬å¼€å‘è€…æŒ‡å—ï¼Œæ‚¨å¯ä»¥é«˜æ•ˆåœ°å‚ä¸ ImgToss çš„å¼€å‘ï¼Œä¸ºè¿™ä¸ªå¼€æºé¡¹ç›®è´¡çŒ®è‡ªå·±çš„åŠ›é‡ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œæ¬¢è¿åœ¨ GitHub Issues ä¸­æå‡ºæˆ–åŠ å…¥ç¤¾åŒºè®¨è®ºã€‚