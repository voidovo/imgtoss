# 用户操作手册

本手册详细介绍 ImgToss 的所有功能特性和操作方法，帮助您充分发挥这款图像上传管理工具的强大功能。

## 界面概览

ImgToss 采用简洁直观的侧边栏导航设计：

```
┌─────────────┬─────────────────────────────────┐
│  📊 仪表板   │                                │
│  🖼️ 图片上传  │        主要内容区域              │
│  📝 文章上传  │                                │
│  📚 历史记录  │                                │
│  ⚙️ 存储配置  │                                │
└─────────────┴─────────────────────────────────┘
```

- **仪表板**: 显示上传统计和最近活动
- **图片上传**: 直接上传图片文件的主要界面
- **文章上传**: 处理 Markdown 文档的专用模式
- **历史记录**: 查看和管理所有上传历史
- **存储配置**: 云存储服务的配置管理

## 图片上传模式详解

图片上传模式是 ImgToss 最核心的功能，为快速上传单张或多张图片而设计。

### 基础上传操作

#### 方法一: 拖拽上传
1. 打开文件管理器，找到要上传的图片
2. 将图片文件直接拖拽到 ImgToss 的上传区域
3. 松开鼠标，图片将自动添加到上传队列

#### 方法二: 点击选择
1. 点击上传区域的"选择文件"按钮
2. 在文件选择对话框中浏览并选择图片
3. 支持多选：按住 Ctrl (Windows/Linux) 或 Cmd (macOS) 选择多个文件

### 支持的文件格式

| 格式 | 扩展名 | 最大文件大小 | 备注 |
|------|--------|--------------|------|
| JPEG | .jpg, .jpeg | 50MB | 最常用的图片格式 |
| PNG | .png | 50MB | 支持透明背景 |
| GIF | .gif | 20MB | 支持动画 |
| WebP | .webp | 30MB | 现代高效格式 |
| BMP | .bmp | 20MB | 未压缩格式 |
| TIFF | .tiff, .tif | 100MB | 高质量格式 |

### 批量上传管理

#### 上传队列操作
- **添加文件**: 继续拖拽或选择文件添加到队列
- **移除文件**: 点击文件卡片右上角的 ❌ 图标
- **清空队列**: 点击"清空全部"按钮
- **重新排序**: 拖拽文件卡片调整上传顺序

#### 上传设置
```
并发数量: [1-5] (同时上传的文件数)
自动重试: [开启/关闭] (失败时自动重试)
重试次数: [1-3] (最大重试次数)
命名规则: [原文件名/UUID/时间戳]
```

### 上传进度监控

每个文件在上传过程中显示详细的进度信息：

```
📷 screenshot.png
    ████████████░░░░ 75%
    ↑ 2.1MB/s | 剩余 3s | 已上传 1.5MB/2MB
    
状态指示器:
⏳ 等待中    🔄 上传中    ✅ 完成    ❌ 失败    ⏸️ 暂停
```

#### 操作按钮
- **暂停**: 暂停当前文件的上传
- **继续**: 恢复已暂停的上传
- **重试**: 重新上传失败的文件
- **取消**: 取消上传并从队列中移除

### 上传完成处理

#### 链接复制功能
上传完成后，每个文件都提供多种链接格式：

```
原始链接:
https://your-bucket.oss-cn-hangzhou.aliyuncs.com/images/screenshot.png

Markdown 格式:
![screenshot](https://your-bucket.oss-cn-hangzhou.aliyuncs.com/images/screenshot.png)

HTML 格式:
<img src="https://your-bucket.oss-cn-hangzhou.aliyuncs.com/images/screenshot.png" alt="screenshot">
```

点击对应的"复制"按钮即可复制到剪贴板。

#### 批量复制
- **复制所有链接**: 复制所有已上传文件的原始链接
- **复制 Markdown**: 生成 Markdown 格式的图片引用列表
- **导出列表**: 将上传结果导出为 JSON 或 CSV 格式

## 文章上传模式详解

文章上传模式专为 Markdown 文档中的图片处理而设计，能够自动识别、上传和替换图片链接。

### 支持的引用格式

ImgToss 能识别以下 Markdown 图片引用格式：

```markdown
# 标准格式
![alt text](./images/screenshot.png)
![](../assets/diagram.jpg)

# 带标题的格式  
![alt text](./images/screenshot.png "图片标题")

# 相对路径
![图片](images/photo.jpg)
![图片](../../assets/icon.png)

# 绝对路径 (本地)
![图片](/Users/username/Pictures/photo.jpg)
![图片](C:\Users\username\Pictures\photo.jpg)
```

### 文档扫描流程

#### 步骤 1: 选择文档
1. 点击"选择 Markdown 文件"或拖拽 .md 文件到界面
2. 支持选择多个 Markdown 文件进行批量处理
3. 系统自动检测文件编码（UTF-8、GBK等）

#### 步骤 2: 图片扫描
系统会自动执行以下扫描操作：
- 解析 Markdown 语法，提取图片引用
- 解析相对路径和绝对路径
- 检查图片文件是否存在
- 生成图片缩略图预览
- 检测重复引用和重复文件

#### 步骤 3: 预览和选择
扫描完成后，界面显示所有找到的图片：

```
📄 document.md (发现 3 张图片)
  
  ✅ [选中] 📷 screenshot.png
      路径: ./images/screenshot.png  
      大小: 1.2MB | 尺寸: 1920x1080
      预览: [缩略图]
      
  ⚠️ [跳过] 📷 logo.jpg (已存在)
      SHA256: a1b2c3... (与历史记录匹配)
      
  ❌ [错误] 📷 missing.png
      错误: 文件不存在
```

状态说明：
- ✅ **选中**: 将被上传的新图片
- ⚠️ **跳过**: 检测到重复，将跳过上传
- ❌ **错误**: 文件不存在或无法读取

### 选择性上传

您可以灵活控制哪些图片需要上传：

#### 批量操作
- **全选**: 选中所有可上传的图片
- **全不选**: 取消所有选择
- **反选**: 切换所有图片的选择状态
- **仅选择新图片**: 只选择未上传过的图片

#### 单独控制
- 点击图片卡片的复选框来单独控制
- 右键图片卡片显示更多选项：
  - 在文件管理器中显示
  - 用默认程序打开
  - 复制文件路径
  - 排除此文件类型

### 上传与替换

#### 开始上传
1. 选择好要上传的图片后，点击"开始上传"
2. 系统按选择顺序依次上传图片
3. 实时显示每个文件的上传进度
4. 支持暂停、继续、取消操作

#### 自动链接替换
上传完成后，系统自动执行链接替换：

**替换前:**
```markdown
![截图](./images/screenshot.png)
```

**替换后:**
```markdown
![截图](https://your-bucket.oss-cn-hangzhou.aliyuncs.com/images/screenshot-20240130-143022.png)
```

#### 安全备份机制
- **自动备份**: 修改文件前自动创建 `.bak` 备份文件
- **备份命名**: `filename.md.bak.20240130-143022`
- **恢复功能**: 可一键恢复到修改前的状态
- **备份清理**: 自动清理 30 天前的备份文件

### 批量文档处理

#### 多文件上传
1. 选择多个 Markdown 文件
2. 系统逐个扫描和处理
3. 可设置统一的上传规则
4. 支持暂停和恢复批量操作

#### 文档统计
处理完成后显示详细统计：
```
处理完成报告:
├─ 处理文件数: 5
├─ 发现图片数: 28
├─ 上传成功数: 23
├─ 跳过重复数: 4
├─ 上传失败数: 1
└─ 链接替换数: 23
```

## 历史记录管理

历史记录功能提供完整的上传历史追踪和管理功能。

### 历史记录界面

#### 列表视图
```
📅 2024年1月30日
  14:32  ✅ screenshot.png (1.2MB) → 阿里云OSS
         📋 https://bucket.oss-cn-hangzhou.aliyuncs.com/...
  
  14:15  ✅ diagram.jpg (856KB) → 腾讯云COS  
         📋 https://bucket.cos.ap-beijing.myqcloud.com/...
         
📅 2024年1月29日
  09:45  ⚠️ photo.png (2.1MB) → AWS S3 (重复文件)
  09:43  ✅ avatar.jpg (234KB) → AWS S3
```

#### 卡片视图
每条记录显示为独立卡片，包含：
- 文件缩略图
- 文件名和大小
- 上传时间和存储服务
- SHA256 校验和
- 操作按钮

### 搜索和筛选

#### 快速搜索
在搜索框中输入关键词，支持搜索：
- 文件名（支持模糊匹配）
- 文件扩展名
- 存储服务名称
- 上传日期

#### 高级筛选
```
时间范围: [今天] [最近7天] [最近30天] [自定义]
文件类型: [全部] [图片] [文档] [其他]
存储服务: [全部] [阿里云OSS] [腾讯云COS] [AWS S3]
上传状态: [全部] [成功] [失败] [重复]
文件大小: [全部] [<1MB] [1-10MB] [>10MB]
```

#### 排序选项
- 按上传时间 (默认)
- 按文件大小
- 按文件名
- 按存储服务

### 记录操作

#### 单个记录操作
- **复制链接**: 复制文件的访问URL
- **重新上传**: 重新上传该文件
- **删除记录**: 从历史记录中删除（不删除云端文件）
- **在浏览器中打开**: 打开文件访问URL
- **查看详情**: 显示详细的上传信息

#### 批量操作
- **批量复制**: 选择多条记录，批量复制链接
- **批量删除**: 清理不需要的历史记录
- **批量重新上传**: 对失败的记录进行批量重新上传
- **导出选中**: 将选中的记录导出为文件

### 重复检测

#### 检测机制
ImgToss 使用 SHA256 算法对文件内容进行校验：
- 上传前自动计算文件的 SHA256 值
- 与历史记录中的校验和进行对比
- 发现重复时提供跳过或覆盖选项

#### 重复处理策略
```
发现重复文件时的处理选项:
○ 跳过上传 (推荐)
○ 重新上传并重命名
○ 覆盖原文件
○ 询问用户操作
```

#### 重复文件标识
- 在历史记录中用 ⚠️ 图标标识重复文件
- 显示首次上传时间和相关文件信息
- 提供重复文件组的查看功能

### 数据导出

#### 导出格式
支持将历史记录导出为多种格式：

**JSON 格式:**
```json
{
  "export_time": "2024-01-30T14:30:22Z",
  "total_records": 156,
  "records": [
    {
      "id": "uuid-here",
      "filename": "screenshot.png",
      "original_path": "./images/screenshot.png",
      "upload_url": "https://...",
      "file_size": 1234567,
      "sha256": "a1b2c3...",
      "upload_time": "2024-01-30T14:32:15Z",
      "storage_service": "aliyun_oss",
      "status": "success"
    }
  ]
}
```

**CSV 格式:**
```csv
文件名,原始路径,上传链接,文件大小,上传时间,存储服务,状态
screenshot.png,./images/screenshot.png,https://...,1234567,2024-01-30 14:32:15,阿里云OSS,成功
```

#### 导出选项
- **全部记录**: 导出所有历史记录
- **当前筛选**: 导出当前筛选结果
- **选中记录**: 仅导出选中的记录
- **时间范围**: 导出指定时间范围的记录

### 存储空间统计

#### 使用统计
```
存储统计 (最近30天):
├─ 阿里云OSS
│  ├─ 文件数量: 45
│  ├─ 总大小: 123.4 MB
│  └─ 平均大小: 2.7 MB
│
├─ 腾讯云COS  
│  ├─ 文件数量: 23
│  ├─ 总大小: 67.8 MB
│  └─ 平均大小: 2.9 MB
│
└─ AWS S3
   ├─ 文件数量: 12
   ├─ 总大小: 34.2 MB
   └─ 平均大小: 2.8 MB
```

#### 趋势分析
- 每日上传量趋势图
- 文件类型分布饼图
- 存储服务使用占比
- 月度使用量对比

## 存储配置管理

存储配置是 ImgToss 的核心功能，支持多个云存储服务的统一管理。

### 多配置管理

#### 配置列表
```
📦 阿里云OSS-主要 (默认)
   Bucket: my-images-bucket
   区域: 华东1(杭州)
   状态: ✅ 连接正常
   
📦 腾讯云COS-备用
   Bucket: backup-images-1234567890  
   区域: 北京
   状态: ⚠️ 配置待测试
   
📦 AWS S3-海外
   Bucket: global-images
   区域: us-east-1
   状态: ❌ 连接失败
```

#### 配置操作
- **新增配置**: 添加新的存储服务配置
- **编辑配置**: 修改现有配置信息
- **删除配置**: 删除不再使用的配置
- **设为默认**: 设置默认使用的存储服务
- **测试连接**: 验证配置是否正确
- **复制配置**: 基于现有配置创建新配置

### 配置详细设置

#### 基础配置
```
配置名称: [自定义名称]
存储类型: [阿里云OSS / 腾讯云COS / AWS S3 / 自定义S3]
端点地址: [服务端点URL]
Bucket名称: [存储桶名称]
区域: [服务区域]
```

#### 认证信息
```
访问密钥ID: [Access Key ID]
访问密钥Secret: [Access Key Secret] 
安全令牌: [STS Token] (可选)
```

#### 高级设置
```
自定义路径前缀: images/{year}/{month}/
文件命名规则: {original} | {timestamp} | {uuid}
访问权限: 私有 | 公共读 | 公共读写
CDN加速域名: [自定义域名] (可选)
HTTPS强制: ✅ 启用
```

#### 上传设置
```
最大并发数: [1-10]
分片上传阈值: [50MB]
分片大小: [5MB]
超时时间: [300s]
重试次数: [3次]
```

### 连接测试

#### 测试项目
配置完成后，系统会执行全面的连接测试：

```
正在测试存储配置...

✅ 网络连接测试
   ├─ DNS解析: 正常
   ├─ 端点访问: 正常  
   └─ 响应时间: 89ms

✅ 认证信息验证
   ├─ 访问密钥: 有效
   ├─ 权限检查: 通过
   └─ Bucket访问: 正常

✅ 上传功能测试  
   ├─ 创建测试文件: 成功
   ├─ 文件上传: 成功
   ├─ 访问URL: 有效
   └─ 清理测试文件: 完成

🎉 配置测试通过！
```

#### 错误诊断
如果测试失败，系统提供详细的错误诊断：

```
❌ 配置测试失败

错误详情:
├─ 错误代码: InvalidAccessKeyId
├─ 错误信息: The AWS Access Key Id you provided does not exist
├─ 建议修复: 请检查Access Key ID是否正确

常见解决方案:
• 确认访问密钥信息无误
• 检查Bucket名称和区域设置
• 验证账户权限设置
• 确认网络连接正常
```

### 安全设置

#### 凭证加密
- 所有访问凭证使用 Tauri Stronghold 加密存储
- 本地密钥管理，密钥不会离开设备
- 支持主密码保护敏感配置
- 自动清理内存中的敏感信息

#### 权限控制
```
配置权限设置:
○ 只读权限 (仅下载文件)
○ 上传权限 (上传和下载)  
○ 管理权限 (完全控制) ⚠️

建议: 为安全考虑，建议使用最小权限原则
```

#### 访问日志
```
配置访问日志:
2024-01-30 14:32:15 - 配置测试 - 成功
2024-01-30 14:30:22 - 上传文件 - 成功  
2024-01-30 14:28:10 - 配置修改 - 成功
2024-01-30 14:25:33 - 连接失败 - 重试
```

## 高级功能

### 自动化设置

#### 监控文件夹
设置监控本地文件夹，自动上传新增的图片文件：

```
监控设置:
监控路径: /Users/username/Desktop/screenshots
文件类型: *.png, *.jpg, *.jpeg
上传延迟: 5秒 (避免文件正在写入)
自动重命名: ✅ 启用
存储配置: 阿里云OSS-主要
```

#### 定时任务
```
定时上传任务:
任务名称: 每日备份
执行时间: 每天 02:00
监控路径: /Users/username/Documents/images
上传完成后: 移动到备份文件夹
```

### 批量处理

#### 文件重命名
```
批量重命名规则:
原文件名: IMG_20240130_143022.jpg
重命名为: screenshot-20240130-143022.jpg

规则模板:
{prefix}-{date}-{time}.{ext}
{category}/{date}/{original}
{uuid}.{ext}
```

#### 图片处理
```
自动图片处理:
□ 压缩图片 (质量: 85%)
□ 添加水印 (位置: 右下角)
□ 调整尺寸 (最大: 1920x1080)
□ 格式转换 (转为: WebP)
```

### 第三方集成

#### 浏览器扩展
安装 ImgToss 浏览器扩展后，可直接在网页中：
- 右键图片选择"上传到 ImgToss"
- 批量上传网页中的所有图片
- 自动替换网页中的图片链接

#### API 接口
ImgToss 提供本地 HTTP API，支持第三方应用集成：
```bash
# 上传文件
POST http://localhost:37259/api/upload
Content-Type: multipart/form-data

# 获取历史记录
GET http://localhost:37259/api/history

# 获取配置列表
GET http://localhost:37259/api/configs
```

#### 命令行工具
```bash
# 安装 CLI 工具
npm install -g imgtoss-cli

# 上传单个文件
imgtoss upload screenshot.png

# 批量上传文件夹
imgtoss upload ./images --recursive

# 处理 Markdown 文档
imgtoss process document.md
```

## 键盘快捷键

| 功能 | Windows/Linux | macOS |
|------|---------------|-------|
| 新建上传 | Ctrl + N | Cmd + N |
| 选择文件 | Ctrl + O | Cmd + O |
| 全选文件 | Ctrl + A | Cmd + A |
| 删除选中 | Delete | Delete |
| 开始上传 | Ctrl + U | Cmd + U |
| 暂停上传 | Ctrl + P | Cmd + P |
| 复制链接 | Ctrl + C | Cmd + C |
| 刷新列表 | F5 | Cmd + R |
| 打开设置 | Ctrl + , | Cmd + , |
| 切换主题 | Ctrl + T | Cmd + T |

## 个性化设置

### 界面定制
```
外观设置:
主题模式: 自动 | 浅色 | 深色
界面语言: 简体中文 | English
字体大小: 小 | 中 | 大
紧凑模式: ✅ 启用

窗口设置:
启动时窗口大小: 记住上次大小
最小化到系统托盘: ✅ 启用  
开机自启动: □ 禁用
```

### 通知设置
```
通知配置:
上传完成通知: ✅ 启用
上传失败通知: ✅ 启用
系统托盘通知: ✅ 启用
声音提醒: □ 禁用

通知样式: 原生系统通知 | 应用内通知
```

### 性能设置
```
性能优化:
最大并发上传数: [1-5]
内存使用限制: 512MB
缓存大小: 100MB
自动清理临时文件: ✅ 启用
```

通过以上详细的操作手册，您可以充分掌握 ImgToss 的所有功能，提升图片上传和管理的效率。如有其他问题，请参考 [故障排除指南](./故障排除.md) 或联系技术支持。