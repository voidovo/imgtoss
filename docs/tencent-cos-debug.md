# 腾讯云 COS 连接调试指南

本文档介绍如何使用腾讯云 COS 连接调试工具来诊断和解决连接问题。

## 功能概述

腾讯云 COS 连接调试工具提供以下功能：

1. **配置验证** - 验证腾讯云 COS 配置格式是否正确
2. **DNS 解析测试** - 测试域名解析是否正常
3. **基本连接测试** - 测试网络连接是否可达
4. **认证请求测试** - 测试签名算法和认证是否正确

## 使用方法

### 1. 访问调试页面

在应用中导航到调试页面：`/debug/tencent-cos`

### 2. 填写配置信息

需要填写以下必需信息：

- **存储桶名称**: 您在腾讯云创建的存储桶名称
- **APPID**: 腾讯云账户的 APPID（通常是一串数字）
- **SecretKey**: 腾讯云 API 密钥
- **地域**: 存储桶所在的地域

### 3. 运行调试

点击"完整调试"按钮运行完整的连接诊断，或点击"快速测试"进行简单的连接测试。

## 配置说明

### APPID 获取方法

1. 登录腾讯云控制台
2. 进入"访问管理" > "API密钥管理"
3. 在页面上方可以看到您的 APPID

### SecretKey 获取方法

1. 登录腾讯云控制台
2. 进入"访问管理" > "API密钥管理"
3. 创建或查看现有的 API 密钥
4. 复制 SecretKey

### 地域代码

常用的腾讯云地域代码：

- `ap-beijing` - 北京
- `ap-shanghai` - 上海
- `ap-guangzhou` - 广州
- `ap-chengdu` - 成都
- `ap-chongqing` - 重庆
- `ap-hongkong` - 香港
- `ap-singapore` - 新加坡

## 常见问题解决

### DNS 解析失败

**症状**: 显示 DNS 解析失败错误

**解决方案**:
1. 检查网络连接是否正常
2. 确认防火墙没有阻止 HTTPS 连接
3. 尝试更换 DNS 服务器（如 8.8.8.8 或 114.114.114.114）
4. 检查是否在企业网络环境中，可能需要配置代理

### 认证失败 (403 错误)

**症状**: 连接成功但认证失败，返回 403 状态码

**解决方案**:
1. 检查 APPID 是否正确（应该是纯数字）
2. 检查 SecretKey 是否正确且没有多余的空格
3. 确认账户有访问该存储桶的权限
4. 检查 API 密钥是否已启用

### 存储桶不存在 (404 错误)

**症状**: 返回 404 状态码

**解决方案**:
1. 检查存储桶名称是否正确
2. 确认存储桶在指定地域中
3. 检查 APPID 是否与存储桶匹配
4. 确认存储桶没有被删除

### 连接超时

**症状**: 请求超时，无法连接到服务器

**解决方案**:
1. 检查网络连接稳定性
2. 尝试更换网络环境
3. 检查防火墙设置
4. 确认选择的地域是否正确

## 调试输出说明

调试工具会输出详细的日志信息，包括：

- 🔍 配置验证结果
- 🌐 DNS 解析结果
- 📡 HTTP 请求和响应详情
- 🔐 签名生成过程
- 📊 响应状态码和头信息

### 成功的调试输出示例

```
✅ 配置格式验证通过
✅ DNS 解析成功: bucket-appid.cos.region.myqcloud.com -> 1.2.3.4
✅ 基本连接成功 - 存储桶可访问
✅ 认证成功 - 存储桶可访问
```

### 失败的调试输出示例

```
❌ DNS 解析失败: bucket-appid.cos.region.myqcloud.com - 域名不存在
💡 检查存储桶名称、APPID 和地域是否正确
```

## 技术实现

调试工具基于腾讯云 COS 官方 API 文档实现：

- 使用正确的域名格式：`<bucket>-<appid>.cos.<region>.myqcloud.com`
- 实现了完整的签名算法（SHA1-HMAC）
- 支持所有腾讯云地域
- 提供详细的错误诊断信息

## 安全注意事项

1. **不要在生产环境中暴露调试工具**
2. **确保 SecretKey 的安全性**
3. **调试完成后清除敏感信息**
4. **使用最小权限原则配置 API 密钥**

## 获取帮助

如果调试工具无法解决您的问题，请：

1. 查看完整的调试输出日志
2. 检查腾讯云控制台中的存储桶配置
3. 联系腾讯云技术支持
4. 参考腾讯云 COS 官方文档